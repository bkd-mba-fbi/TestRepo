name: Retire.js Code Scan

on:
  push:
    branches: [ main ]
  pull_request:

permissions:
  contents: read
  security-events: write

jobs:
  retire:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install Retire.js & retire-to-sarif
        run: |
          npm install -g retire
          npm install -g @philips-software/retire-to-sarif

      - name: Run Retire.js
        run: |
          mkdir -p reports
          retire --outputformat json --outputpath reports/retire-report.json || true

      - name: Convert to SARIF
        run: |
          retire-to-sarif -i reports/retire-report.json -o reports/retire-report.sarif

      - name: Upload SARIF
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: reports/retire-report.sarif
